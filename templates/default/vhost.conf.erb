# Configuration generated by Chef
# DO NOT MODIFY
# Changes to this file will be automatically overwritten.
#
<VirtualHost *:80>
  ServerName <%= @params[:server_name] %>
  ServerAlias <% @params[:server_aliases].each do |a| %><%= "#{a}" %> <% end %>
  DocumentRoot <%= @params[:docroot] %>

  SetEnv MAGE_IS_DEVELOPER_MODE <%= node[:magento][:developer_mode] %>
  SetEnv MAGE_ENABLE_PROFILER <%= node[:magento][:enable_profiler] %>

  LogLevel info
  ErrorLog <%= node[:apache][:log_dir] %>/<%= @params[:name] %>-error.log
  CustomLog <%= node[:apache][:log_dir] %>/<%= @params[:name] %>-access.log combined

  <Directory />
    Order deny,allow
    Deny from all
    AllowOverride None
  </Directory>

  <Directory <%= @params[:docroot] %>>
    Options FollowSymLinks
    AllowOverride All
    Order allow,deny
    Allow from all
    DirectoryIndex index.php index.html

    <IfModule mod_rewrite.c>
        Options +FollowSymLinks
        RewriteEngine on
        #RewriteBase /magento/
        RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]
        RewriteCond %{REQUEST_URI} !^/(media|skin|js)/
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteCond %{REQUEST_FILENAME} !-l
        RewriteRule .* index.php [L]
    </IfModule>


    <% %w{.gitignore RELEASE_NOTES.txt README.md Vagrantfile.example Vagrantfile}.each do |d| -%>
    <Files <%= d %>>
      order allow,deny
      deny from all
    </Files>
    <% end -%>

  </Directory>


  AddDefaultCharset Off
  #AddDefaultCharset UTF-8
             
  <IfModule mod_php5.c>
      php_value memory_limit 256M
      php_value max_execution_time 18000
      php_flag magic_quotes_gpc off
      php_flag session.auto_start off
      #php_flag zlib.output_compression on
      php_flag zend.ze1_compatibility_mode Off
  </IfModule>

  <IfModule mod_security.c>
      SecFilterEngine Off
      SecFilterScanPOST Off
  </IfModule>

  <IfModule mod_ssl.c>
      SSLOptions StdEnvVars
  </IfModule>

  <IfModule mod_expires.c>
      #ExpiresDefault "access plus 1 year"
  </IfModule>        

  <IfModule mod_deflate.c>
    ###SetOutputFilter DEFLATE
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript
    BrowserMatch ^Mozilla/4 gzip-only-text/html
    BrowserMatch ^Mozilla/4\.0[678] no-gzip
    BrowserMatch \bMSIE !no-gzip !gzip-only-text/html
    SetEnvIfNoCase Request_URI \.(?:gif|jpe?g|png)$ no-gzip dont-vary
    Header append Vary User-Agent env=!dont-vary
   </IfModule>


</VirtualHost>
